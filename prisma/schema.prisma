generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model answers {
  attempt_id  String    @db.Char(36)
  question_id Int
  option_id   Int
  attempts    attempts  @relation(fields: [attempt_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "answers_ibfk_1")
  questions   questions @relation(fields: [question_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "answers_ibfk_2")
  options     options   @relation(fields: [option_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "answers_ibfk_3")

  @@id([attempt_id, question_id])
  @@index([attempt_id], map: "idx_answers_attempt")
  @@index([option_id], map: "option_id")
  @@index([question_id], map: "question_id")
}

model attempts {
  id           String    @id @db.Char(36)
  user_id      String    @db.Char(36)
  score        Int?
  started_at   DateTime? @default(now()) @db.Timestamp(0)
  submitted_at DateTime? @db.Timestamp(0)
  tryout_id    Int
  answers      answers[]
  users        users     @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "attempts_ibfk_1")
  tryouts      tryouts   @relation(fields: [tryout_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_attempt_tryout")

  @@index([tryout_id], map: "fk_attempt_tryout")
  @@index([user_id], map: "idx_attempts_user")
}

model courses {
  id          Int         @id @default(autoincrement())
  title       String      @db.VarChar(100)
  description String?     @db.Text
  created_at  DateTime?   @default(now()) @db.Timestamp(0)
  materials   materials[]
  tryouts     tryouts[]
}

model materials {
  id         Int       @id @default(autoincrement())
  course_id  Int
  title      String    @db.VarChar(150)
  content    String?   @db.Text
  video_url  String?   @db.Text
  created_at DateTime? @default(now()) @db.Timestamp(0)
  courses    courses   @relation(fields: [course_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_material_course")

  @@index([course_id], map: "fk_material_course")
}

model options {
  id          Int       @id @default(autoincrement())
  question_id Int
  text        String    @db.Text
  is_correct  Boolean?  @default(false)
  answers     answers[]
  questions   questions @relation(fields: [question_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "options_ibfk_1")

  @@index([question_id], map: "idx_options_question")
}

model questions {
  id            Int         @id @default(autoincrement())
  text          String      @db.Text
  explanation   String?     @db.Text
  video_url     String?     @db.Text
  created_at    DateTime?   @default(now()) @db.Timestamp(0)
  sub_tryout_id Int
  answers       answers[]
  options       options[]
  sub_tryouts   sub_tryouts @relation(fields: [sub_tryout_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_questions_sub_tryout")

  @@index([sub_tryout_id], map: "fk_questions_sub_tryout")
}

model tryouts {
  id               Int           @id @default(autoincrement())
  course_id        Int
  title            String        @db.VarChar(255)
  description      String?       @db.Text
  duration_minutes Int?
  created_at       DateTime?     @default(now()) @db.Timestamp(0)
  attempts         attempts[]
  sub_tryouts      sub_tryouts[]
  courses          courses       @relation(fields: [course_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_tryout_course")

  @@index([course_id], map: "fk_tryout_course")
}

model users {
  id            String      @id @db.Char(36)
  username      String      @unique(map: "username") @db.VarChar(50)
  password_hash String      @db.VarChar(255)
  created_at    DateTime?   @default(now()) @db.Timestamp(0)
  full_name     String      @db.VarChar(100)
  school_name   String      @db.VarChar(100)
  nickname      String      @db.VarChar(100)
  grade         Int
  major         String?     @db.VarChar(100)
  role          users_role? @default(user)
  attempts      attempts[]
}

model sub_tryouts {
  id          Int         @id @default(autoincrement())
  tryout_id   Int
  title       String      @db.VarChar(255)
  description String?     @db.Text
  questions   questions[]
  tryouts     tryouts     @relation(fields: [tryout_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "sub_tryouts_ibfk_1")

  @@index([tryout_id], map: "tryout_id")
}

enum users_role {
  user
  mentor
  admin
}
